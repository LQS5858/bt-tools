<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>cancelRepeatRequest.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Qrcode.html">Qrcode</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addPendingRequest">addPendingRequest</a></li><li><a href="global.html#GenerateReqKey">GenerateReqKey</a></li><li><a href="global.html#removePendingRequest">removePendingRequest</a></li><li><a href="global.html#RequestInterceptor">RequestInterceptor</a></li><li><a href="global.html#ResponseInterceptor">ResponseInterceptor</a></li><li><a href="global.html#typeOf">typeOf</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">cancelRepeatRequest.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import GenerateReqKey from './generateReqKey'


/**
 * @description
 * &lt;span style="color:red;font-weight:bold">封装用于axios取消重复请求,通过接口传入配置开关{cancelRequest:true}决定是否开启取消重复请求&lt;/span>
 * |输入|说明|输出
 * |---|---|---
 * |config|例如:{cancelRequest:true}|无
 * # Example
 *
 * ```
 * import {CancelRepeatRequest} from 'bt-tools'
 * CancelRepeatRequest.addPendingRequest(config)
 * ```
 * @param {Object} config - 该参数为axios的请求拦截的配置参数config,如{cancelRequest:true}
 * @method addPendingRequest
 * @return 无
 * @version 1.1.0
 * @author Ricardo
 */
let pendingRequest = new Map() //map保存键值对，任何值(对象或者原始值)都可以作为键

function addPendingRequest (config, axios) {
    const { cancelRequest } = config || {}
    console.log(`[接口是否配置取消请求]:>>>`, cancelRequest);
    if (cancelRequest) {
        const requestKey = GenerateReqKey(config)
        if (pendingRequest.has(requestKey)) {
            config.cancelToken = new axios.CancelToken(cancel => {
                console.log(`[请求已取消]:>>>`, config.url);
                cancel(`${config.url} 请求已取消`)
            })
        } else {
            config.cancelToken = config.cancelToken || new axios.CancelToken(cancel => {
                pendingRequest.set(requestKey, cancel)
            })
        }
    }

}

/**
 * @description
 * &lt;span style="color:red;font-weight:bold">axios响应正常移除pendingReques中键值对&lt;/span>
 * |输入|输出
 * |---|---
 * |response|无
 * # Example
 * ```
 * import {CancelRepeatRequest} from 'bt-tools'
 * CancelRepeatRequest.removePendingRequest(response)
 * ```
 * @param {Object} response -axios响应拦截对象
 * @return 无
 * @version 1.1.0
 * @author Ricardo
 */

function removePendingRequest (response) {
    const { cancelRequest } = response?.config || {}
    console.log(`[响应成功打印重复请求取消配置]:&lt;&lt;&lt;`, cancelRequest);
    if (cancelRequest) {
        const requestKey = GenerateReqKey(response?.config)
        if (pendingRequest.has(requestKey)) {
            const cancelToken = pendingRequest.get(requestKey)
            console.log(`[响应成功开始移除请求键]:&lt;&lt;&lt;`, requestKey);
            cancelToken(requestKey)
            pendingRequest.delete(requestKey)
        }
    }
}

const obj = { removePendingRequest, addPendingRequest }

export default obj</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Wed Jun 09 2021 08:18:48 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
